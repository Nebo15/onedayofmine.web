<?
$this->title = "Live the life through other people's eyes";
$this->menu = 'discover';
?>
{{wrap with="layout.phtml"}}
{{into slot="css"}}
.nav { margin-bottom:0px; }
.centered-pills { text-align:center; }
.centered-pills ul.nav-pills { display:inline-block; }
.centered-pills li { display:inline; }
.centered-pills a { float:left; }
* html .centered-pills ul.nav-pills { display:inline; } /* IE6 */
*+html .centered-pills ul.nav-pills { display:inline; } /* IE7 */
.ratings li a { font-size:24px }
{{/into}}
{{into slot="js_ready"}}
(function() {

var $search_form = $('.form-search');
var $search_form_query = $search_form.find('.search-query');
var $search_form_submit = $search_form.find('button');
var $search_result = $('.days');
var $popular_days = $('.popular');

function clearAndSpin()
{
$('.nav-pills li.active').removeClass('active');
$search_form_query.val('');
$search_result.html('');
$('.has-spinner').showSpinner();
}

$('.top-action').click(function() {
clearAndSpin();
$(this).addClass('active');
API.request('GET', 'days/interesting').success(show_days_by_response).send();
});

$('.following-action').click(function() {
clearAndSpin();
$(this).addClass('active');
API.request('GET', 'days/following').success(show_days_by_response).send();
});

$('.new-action').click(function() {
clearAndSpin();
$(this).addClass('active');
API.request('GET', 'days/new').success(show_days_by_response).send();
});

$('.queries li').click(function() {
clearAndSpin();
$search_form_query.val($(this).find('a').html());
$search_form.submit();
$(this).addClass('active');
});

function show_days_by_response(response)
{
$('.has-spinner').hideSpinner();
if(response.data.result.length === 0)
{
$search_result.html("<p>We can't find any days by your query</p>");
}
else
{
var template_list = Template.prepareTemplate($('#days_list_elements_template'));
var days = Template.compileElement(template_list, {
days: response.data.result
});

days = $($.trim(days));
$($search_result).html(days);
$($search_result).masonry('reload', days);
}
}

$search_form_query.attachValidator({
button: $search_form_submit,
maxLength: 100,
minLength: 3,
messages: {
empty: 'Search query is empty',
minLength: 'Search query is too short',
maxLength: 'Search query is too long'
}
});

$search_form.submit(function(event) {

var search_request = API.request('POST', 'days/search', {
query: $search_form_query.val()
});

search_request.success(show_days_by_response);
search_request.send();
return false;
});

})();
{{/into}}

{{into slot="content"}}
<div class="row-fluid">
  <center>
    <form class="form-search days-search-form">
      <input type="search" autofocus class="input-xlarge search-query span5"
             placeholder="Occupation, place or something else">
      <button type="submit" class="btn">Discover!</button>
    </form>
  </center>
</div>
<div class="row">
  <div class="span12 centered-pills">
    <ul class="nav nav-pills ratings">
      <li class="active top-action"><a href="#">Top</a></li>
      <? if($this->current_user) { ?>
        <li class="following-action"><a href="#">Following</a></li>
      <? } ?>
      <li class="new-action"><a href="#">New</a></li>
    </ul>
  </div>
</div>
<div class="row">
  <div class="span12 centered-pills">
    <ul class="nav nav-pills queries">
      <li><a href="#">filmmaker</a></li>
      <li><a href="#">entrepreneur</a></li>
      <li><a href="#">programmer</a></li>
    </ul>
  </div>
</div>
<div class="row">
  <div class="span12 centered-pills">
    <ul class="nav nav-pills queries">
      <li><a href="#">Kiev</a></li>
      <li><a href="#">London</a></li>
      <li><a href="#">Tel Aviv</a></li>
    </ul>
  </div>
</div>

<hr/>
<div class="has-spinner">
  <i class="spinner icon-spin icon-refresh"></i>
  <ul class="days clearfix block-center">
    <div class="popular">
      {{apply template="days_list" days="$#days"/}}
    </div>
  </ul>
</div>

{{/into}}
{{/wrap}}
