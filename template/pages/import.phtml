<?
$this->title = 'Create a day';
$this->menu = 'create_day';

$this->steps = [
	!((bool) $this->toolkit->getUser()),
	!$this->toolkit->getUser() || !$this->toolkit->getUser()->instagram_uid,
	!$this->toolkit->getUser() || !$this->toolkit->getUser()->flickr_uid
];

$this->facebook_app_id = $this->toolkit->getConf('facebook')->appId;
$this->instagram = $this->toolkit->getConf('common')->instagram;
?>
{{wrap with="layout.phtml"}}
{{into slot="js_include"}}
<link href="/styles/vendor/fuelux.css" rel="stylesheet">
<link href="/styles/vendor/fuelux-responsive.css" rel="stylesheet">
<script src="/lib/vendor/fuelux-wizard.js"></script>
<script src="/lib/Importer.js"></script>
<script src="/app/import.js"></script>
{{/into}}
{{into slot="templates"}}

<script id="template_import_day" type="text/x-handlebars-template">
	<li class="day well" style="opacity:0">
		<ul class="thumbnails"></ul>
		<button class="btn step3-action">
			<i class="icon icon-arrow-left"/></i>
			&nbsp;Back
		</button>
		<button class="btn btn-large btn-success analyze-action skip-action">
			<i class="show-when-parent-disabled icon icon-spin icon-refresh"></i>
			Publish!
		</button>
		<button class="btn step5-action">
			Skip&nbsp;
			<i class="icon icon-arrow-right"/></i>
		</button>
		<div class="pull-right">
			<h4 class="muted"></h4>
		</div>
	</li>
</script>

<script id="template_import_moment" type="text/x-handlebars-template">
	<li class="inline" style="opacity:0">
		<div class="thumbnail">
			<div class="img-wrap img-rounded" style="background-image: url('[[image]]');">
				<span class="bage-bottom-right"><i class="icon-remove"></i></span>
			</div>
		</div>
	</li>
</script>

{{/into}}
{{into slot="content"}}
<div id="error_container" class="well cant alert alert-danger" style="display:none; margin-top:20px;"></div>
<div class="fuelux">
	<div id="wizard" class="wizard">
		<ul class="steps">
			<li data-target="#step1" class="active"><span class="badge badge-info">1</span>Sign up<span class="chevron"></span></li>
			<li data-target="#step2"><span class="badge">2</span>Instagram<span class="chevron"></span></li>
			<li data-target="#step3"><span class="badge">3</span>Flickr<span class="chevron"></span></li>
			<li data-target="#step4"><span class="badge">4</span>Select a day<span class="chevron"></span></li>
			<li data-target="#step5"><span class="badge">5</span>Publish<span class="chevron"></span></li>
		</ul>
	</div>
	<br class="clearFix"/>


	<div class="step-content">

		<div class="step-pane active" id="step1">
				<button class="btn btn-large facebook-action">
					<i class="icon icon-facebook-sign"/></i>
					&nbsp;Login with facebook
				</button>
		</div>

		<div class="step-pane" id="step2">
			<button class="btn btn-large instagram-action">
				<img src="http://instagram.com/favicon.ico"/>
				&nbsp;Connect to instagram
			</button>
			<button class="btn step3-action">
				Skip&nbsp;<i class="icon icon-arrow-right"/></i>
			</button>
		</div>

		<div class="step-pane" id="step3">
			<button class="btn step2-action">
				<i class="icon icon-arrow-left"/></i>
				&nbsp;Back
			</button>
			<button class="btn btn-large flickr-action">
				<img src="http://l.yimg.com/g/favicon.ico" width="16"/>
				&nbsp;Connect to Flickr
			</button>
			<button class="btn step4-action">
				Skip&nbsp;<i class="icon icon-arrow-right"/></i>
			</button>
		</div>

		<div class="step-pane" id="step4">
			<div id="loader_container" class="well cant text-center" style="display:none;">
				<div class="progress row" style="margin:20px 10px 0px 10px;">
					<div class="bar bar-success" style="width: 0%;"></div>
				</div>
			</div>

			<ul class="import_days unstyled"></ul>

			<button class="btn btn-block paginate" style="margin: 10px 0; opacity:0;">
				<i class="show-when-parent-disabled icon icon-spin icon-refresh"></i>
				Load more
			</button>

		</div>

		<div class="step-pane" id="step5">
			<form class="form-horizontal" style="display:none">
				<div class="progress row" style="margin-top:20px; display:none">
					<div class="bar bar-success" style="width: 0%;"></div>
				</div>

				<div class="control-group">
					<label class="control-label">Title</label>
					<div class="controls">
						<input type="text" class="title input-xxlarge">
					</div>
				</div>

				<div class="control-group">
					<label class="control-label">Day type</label>
					<div class="controls">
						<select class="type input-xxlarge">
							<option value="Working day">Working day</option>
							<option value="Day off">Day off</option>
							<option value="Holiday">Holiday</option>
							<option value="Trip">Trip</option>
						</select>
					</div>
				</div>

				<div class="control-group">
					<label class="control-label">Description</label>
					<div class="controls">
						<textarea class="description input-xxlarge" rows="5"></textarea>
					</div>
				</div>

				<div class="text-center">
					<button class="btn step4-action">
						<i class="icon icon-arrow-left"/></i>
						&nbsp;Back
					</button>
					<button class="btn btn-success export-action">
						<i class="show-when-parent-disabled icon icon-spin icon-refresh"></i>
						Save day
						<i class="icon-white icon-arrow-right"></i>
					</button>
				</div>
			</form>
		</div>
	</div>
{{/into}}
{{into slot="js_ready"}}
	var controller = new ImportController($('#wizard'), $('.step-content'));
	<? if($this->steps[0]) { ?>
		controller.step1();
	<? } elseif($this->steps[1]) { ?>
		controller.step2();
	<? } elseif($this->steps[2]) { ?>
		controller.step3();
	<? } else { ?>
		controller.step4();
	<? } ?>
{{/into}}
{{/wrap}}