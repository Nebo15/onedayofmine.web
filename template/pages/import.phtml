{{wrap with="layout.phtml"}}
{{into slot="css"}}
.remove-photo-action {
	cursor:pointer;
}
.thumbnails {
	margin-left:0px;
}
.thumbnails > li {
	margin:3px 3px 0 0;
}

.thumbnail {
	border: none;
	-webkit-border-radius: 0;
	-moz-border-radius: 0;
	border-radius: 0;
	-webkit-box-shadow: none;
	-moz-box-shadow: none;
	box-shadow: none;
	-webkit-transition: none;
}

{{/into}}
{{into slot="content"}}
        <div>
            <h3>Import from Instagram</h3>

            <div class="progress" style="display:none">
                <div class="bar bar-success" style="width: 0%;"></div>
            </div>

            <center><a href="https://api.instagram.com/oauth/authorize/?client_id={$#instagram.client_id}&redirect_uri={$#instagram.redirect_url}&response_type=token"
               class="btn btn-danger btn-large" style="display:none">
                Step 1 of 3 <i class="icon-white icon-forward"></i>
            </a></center>

            <div class="well cant alert alert-danger" style="display:none">
		            Sorry. You have no days with 3 or more photos.
            </div>

            <div class="days"></div>

						<button class="btn btn-block btn-large btn-info hide export-action" style="margin: 10px 0">more&hellip;<button>

            <div class="alert alert-info hide">
		            Import from custom instagram account (debug only):
                <form class="form-inline custom-import-action">
                    <input type="text" class="input-small" placeholder="username">
                    <input class="btn btn-info" type="submit" value="Import"/>
                </form>
            </div>
        </div>
{{/into}}
{{into slot="templates"}}
	<script id="day-item" type="text/x-handlebars-template">
      <div day_pos="[[day_position]]" class="well">
          <h4 class="time">[[time]]</h4>
		      <div class="step2">
				      <ul class="thumbnails">
							[[#moments]]
				          <li style="width:160px;">
						          <div class="thumbnail">
								          <div class="img-wrap img-rounded"  style="background:#fff">
									            <a class="remove-photo-action" day_pos="[[../day_position]]" moment_id="[[id]]">
                                <img src="[[images.thumbnail.url]]" class="img-rounded" alt="[[caption.text]]" title="[[caption.text]]"/>
															</a>
                          </div>
						          </div>
				          </li>
					    [[/moments]]

				      </ul>
			        <button class="btn btn-large btn-block btn-warning analyze-action">
				        Step 2 of 3 <i class="icon-white icon-forward"></i> </button>
				  </div>
		      <div class="step3" style="display:none">
						<form class="form-horizontal">
                <div class="control-group">
                    <label class="control-label " for="type_[[day_position]]">Day type</label>
                    <div class="controls">
                        <select id="type_[[day_position]]" class="type input-xxlarge">
                            <option value="Working day">Working day</option>
                            <option value="Day off">Day off</option>
                            <option value="Holiday">Holiday</option>
                            <option value="Trip">Trip</option>
		                    </select>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label" for="title_[[day_position]]">Title</label>
                    <div class="controls">
                        <input type="text" id="title_[[day_position]]" class="title input-xxlarge">
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label" for="desc_[[day_position]]">Description</label>
                    <div class="controls">
                        <textarea id="desc_[[day_position]]" class="desc input-xxlarge" rows="5"></textarea>
                    </div>
                </div>

                <center><button class="btn btn-success btn-large export-action">
                    Final step! <i class="icon-white icon-forward"></i> </button></center>
						</form>
		      </div>
      </div>
	</script>
{{/into}}
{{into slot="js_include"}}
  <script src="/lib/Importer.js"></script>
	<script src="/lib/vendor/jquery.scrollTo-1.4.3.1-min.js"></script>
{{/into}}
{{into slot="js_ready"}}
  hash = window.location.hash.substr(14);
  $(document).ready(function () {
    if (window.location.hash.length < 2) {
      $('a.btn').show();
    }
    else {
			$('.custom-import-action').parent().show();
      Importer.$days = $('.days');
      Importer.$progress = $('.progress');
      Importer.import(hash);
    }

    $('.export-action').click(function() {
			Importer.exportPhotos();
		});

    $('.custom-import-action').submit(function() {
			Importer.$days.html('');
			Importer.findUser($(this).find('input[type=text]').val(), function(user) {
				Importer.days = [];
				Importer.photos = [];
				Importer.photos_count = 0;
				Importer.$days = $('.days');
				Importer.instagram_user = user.id;
				Importer.$progress = $('.progress');
				Importer.import(hash);
			});
			return false;
		});
  });
{{/into}}
{{/wrap}}
